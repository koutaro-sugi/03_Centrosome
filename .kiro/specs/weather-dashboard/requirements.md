# Weather Dashboard 要件書

## 概要

AWS IoT Core と Mado センサー（M-X）を使用したリアルタイム気象データダッシュボードシステム。既存の Centra アプリケーションに統合し、リアルタイムデータ表示、履歴データ分析、統計情報提供を行う。

## 要件

### 要件 1: リアルタイムデータ表示

**ユーザーストーリー:** ドローンオペレーターとして、現在の気象状況をリアルタイムで確認したいので、最新のセンサーデータが自動更新される画面が必要である。

#### 受け入れ基準

1. WHEN Mado センサーからデータが送信される THEN システムは 1 秒以内にダッシュボードを更新する SHALL
2. WHEN ユーザーがダッシュボードを開く THEN システムは最新の気象データ（温度、湿度、気圧、風速、風向、降水量、照度、視程、体感温度）を表示する SHALL
3. WHEN ネットワーク接続が切断される THEN システムは自動再接続を試行し、接続状態をユーザーに通知する SHALL
4. WHEN データ更新が発生する THEN システムは WebSocket を使用してポーリングなしで更新する SHALL

### 要件 2: 履歴データ表示と永続化

**ユーザーストーリー:** フライトプランナーとして、過去 1 時間の気象トレンドを分析したいので、履歴データがグラフで表示され、ページリロード後も保持される必要がある。

#### 受け入れ基準

1. WHEN ユーザーが履歴データを要求する THEN システムは過去 1 時間の生データを時系列グラフで表示する SHALL
2. WHEN ページがリロードされる THEN システムは保存された履歴データを復元して表示する SHALL
3. WHEN 履歴データが 1 時間を超える THEN システムは古いデータを自動削除する SHALL
4. WHEN グラフが表示される THEN ユーザーは拡大・縮小・パン操作ができる SHALL

### 要件 3: 統計情報計算と表示

**ユーザーストーリー:** 安全管理者として、飛行判断に必要な統計情報（最大瞬間風速など）を確認したいので、自動計算された統計データが表示される必要がある。

#### 受け入れ基準

1. WHEN 10 分間のデータが蓄積される THEN システムは各気象要素の最大・最小・平均値を計算する SHALL
2. WHEN ユーザーが統計情報を要求する THEN システムは過去 1 時間の最大瞬間風速を表示する SHALL
3. WHEN 統計データが更新される THEN システムは 10 分ごとの平均値を更新する SHALL
4. WHEN 統計計算が完了する THEN システムはサンプル数も併せて表示する SHALL

### 要件 4: レスポンシブ UI 設計

**ユーザーストーリー:** モバイルデバイスを使用するフィールドオペレーターとして、様々な画面サイズで気象データを確認したいので、レスポンシブなインターフェースが必要である。

#### 受け入れ基準

1. WHEN ユーザーがモバイルデバイスでアクセスする THEN システムはタッチ操作に最適化された UI を表示する SHALL
2. WHEN 画面サイズが変更される THEN システムはレイアウトを自動調整する SHALL
3. WHEN ダークモード設定が有効な場合 THEN システムはダークテーマで UI を表示する SHALL
4. WHEN タッチデバイスで操作する THEN システムは適切なタッチターゲットサイズを提供する SHALL

### 要件 5: システム統合とセキュリティ

**ユーザーストーリー:** システム管理者として、既存の Centra アプリケーションとの整合性を保ちながら、セキュアな気象データアクセスを提供したいので、認証機能と既存システムとの統合が必要である。

#### 受け入れ基準

1. WHEN ユーザーがダッシュボードにアクセスする THEN システムは Cognito 認証を要求する SHALL
2. WHEN データ通信が発生する THEN システムは HTTPS 暗号化通信を使用する SHALL
3. WHEN GraphQL クエリが実行される THEN システムは Depth リミットを適用して DoS 攻撃を防ぐ SHALL
4. WHEN 既存の Centra 機能が実行される THEN 気象ダッシュボードは他機能に影響を与えない SHALL

### 要件 6: パフォーマンスとコスト制約

**ユーザーストーリー:** プロジェクトマネージャーとして、コスト効率的で高性能なシステムを運用したいので、明確なパフォーマンス基準とコスト上限が設定される必要がある。

#### 受け入れ基準

1. WHEN ユーザーがダッシュボードを初回ロードする THEN システムは 3 秒以内に表示を完了する SHALL
2. WHEN リアルタイムデータが更新される THEN システムは 100ms 以内に画面に反映する SHALL
3. WHEN 同時に 10 クライアントがアクセスする THEN システムは正常に動作する SHALL
4. WHEN 月次コストが計算される THEN システムの運用コストは$10 以下である SHALL
5. WHEN データ保持期間が経過する THEN システムは TTL を使用して自動的にデータを削除する SHALL

### 要件 7: データ処理と API 設計

**ユーザーストーリー:** 開発者として、拡張可能で保守しやすいシステムを構築したいので、明確なデータ構造と API 仕様が定義される必要がある。

#### 受け入れ基準

1. WHEN Mado センサーからデータが受信される THEN システムは定義された JSON 形式でデータを処理する SHALL
2. WHEN DynamoDB にデータが保存される THEN システムは指定されたパーティション/ソートキー構造を使用する SHALL
3. WHEN GraphQL API が呼び出される THEN システムは定義されたスキーマに従ってレスポンスを返す SHALL
4. WHEN リアルタイム配信が必要な場合 THEN システムは AppSync Subscription を使用する SHALL
